#!/usr/bin/env zsh

source ~/.zplug/zplug

set -e

if test "$(uname)" = "Linux"
then
  if test "$(whence apt-get 2> /dev/null)"
  then
    echo "\033[00;32m--›\033[0m updating apt-get"
    sudo apt-get update
    sudo apt-get dist-upgrade
    sudo apt-get autoremove
    sudo apt-get clean
    echo
  elif test "$(whence dnf 2> /dev/null)"
  then
    echo "\033[00;32m--›\033[0m updating dnf"
    sudo dnf clean all
    sudo dnf update
    sudo dnf autoremove
    sudo dnf clean all
    echo
  fi
fi

if test "$(whence brew 2> /dev/null)"
then
  echo "\033[00;32m--›\033[0m updating brew"
  brew update
  brew upgrade --all
  brew cleanup --force
  if test "$(uname)" = "Darwin"
  then
    brew cask cleanup
  fi
  echo
fi

if test "$(whence fzf 2> /dev/null)"
then
  echo "\033[00;32m--›\033[0m updating fzf"
  if test "$(git -C ~/.fzf pull)" != "Already up-to-date."
  then
    ~/.fzf/install --all --no-update-rc
  fi
  echo
fi

if test -d ~/.tmux/plugins/tpm
then
  echo "\033[00;32m--›\033[0m updating tpm"
  git -C ~/.tmux/plugins/tpm pull
  ~/.tmux/plugins/tpm/bin/update_plugins all
  echo
fi

if test "$(whence zplug 2> /dev/null)"
then
  echo "\033[00;32m--›\033[0m updating zplug"
  zplug update
  zplug update --self
  zplug clean --force
  zplug clear --force
  zplug load
  echo
fi

if test "$(whence apm 2> /dev/null)"
then
  echo "\033[00;32m--›\033[0m updating apm"
  apm upgrade -c false
  echo
fi
